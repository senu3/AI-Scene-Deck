/// <reference types="vite/client" />

export {};

interface FileItem {
  name: string;
  path: string;
  isDirectory: boolean;
  children?: FileItem[];
}

interface FolderSelection {
  path: string;
  name: string;
  structure: FileItem[];
}

interface FileInfo {
  name: string;
  path: string;
  size: number;
  modified: Date;
  type: 'image' | 'video' | 'audio' | null;
  extension: string;
}

interface ImageMetadata {
  width?: number;
  height?: number;
  format?: string;
  prompt?: string;
  negativePrompt?: string;
  model?: string;
  seed?: number;
  steps?: number;
  sampler?: string;
  cfg?: number;
  software?: string;
  fileSize?: number;
}

interface VaultInfo {
  path: string;
  trashPath: string;
  configPath: string;
}

interface RecentProject {
  name: string;
  path: string;
  date: string;
}

interface AssetIndexEntry {
  id: string;
  hash: string;
  filename: string;
  originalName: string;
  originalPath: string;
  type: 'image' | 'video' | 'audio';
  fileSize: number;
  importedAt: string;
}

interface AssetIndex {
  version: number;
  assets: AssetIndexEntry[];
}

interface VaultImportResult {
  success: boolean;
  vaultPath?: string;
  relativePath?: string;
  hash?: string;
  isDuplicate?: boolean;
  error?: string;
}

interface VaultVerifyResult {
  valid: boolean;
  missing: string[];
  orphaned: string[];
  error?: string;
}

interface PathResolveResult {
  absolutePath: string | null;
  exists: boolean;
  error?: string;
}

interface FinalizeClipOptions {
  sourcePath: string;
  outputPath: string;
  inPoint: number;
  outPoint: number;
}

interface FinalizeClipResult {
  success: boolean;
  outputPath?: string;
  fileSize?: number;
  error?: string;
}

interface ExtractFrameOptions {
  sourcePath: string;
  outputPath: string;
  timestamp: number;
}

interface ExtractFrameResult {
  success: boolean;
  outputPath?: string;
  fileSize?: number;
  error?: string;
}

interface SequenceItem {
  type: 'image' | 'video' | 'audio';
  path: string;
  duration: number;
  inPoint?: number;
  outPoint?: number;
}

interface ExportSequenceOptions {
  items: SequenceItem[];
  outputPath: string;
  width: number;
  height: number;
  fps: number;
}

interface ExportSequenceResult {
  success: boolean;
  outputPath?: string;
  fileSize?: number;
  error?: string;
}

interface ElectronAPI {
  // Folder operations
  selectFolder: () => Promise<FolderSelection | null>;
  getFolderContents: (folderPath: string) => Promise<FileItem[]>;
  getFileInfo: (filePath: string) => Promise<FileInfo | null>;
  readFileAsBase64: (filePath: string) => Promise<string | null>;

  // Audio file (returns raw ArrayBuffer for Web Audio API)
    readAudioFile: (filePath: string) => Promise<ArrayBuffer | Uint8Array | null>;
    readAudioPcm: (filePath: string) => Promise<{ success: boolean; pcm?: Uint8Array; sampleRate?: number; channels?: number; error?: string } | null>;

  // Image metadata
  readImageMetadata: (filePath: string) => Promise<ImageMetadata | null>;

  // Video metadata
    getVideoMetadata: (filePath: string) => Promise<{ path: string; fileSize: number; format: string; duration?: number; width?: number; height?: number } | null>;
    generateVideoThumbnail: (filePath: string, timeOffset?: number) => Promise<{ success: boolean; thumbnail?: string; error?: string } | null>;

  // Vault operations
  selectVault: () => Promise<string | null>;
  createVault: (vaultPath: string, projectName: string) => Promise<VaultInfo | null>;
  createSceneFolder: (vaultPath: string, sceneName: string) => Promise<string | null>;

  // File operations
  moveToVault: (sourcePath: string, destFolder: string, newName?: string) => Promise<string | null>;
  moveToTrash: (filePath: string, trashPath: string) => Promise<string | null>;
  pathExists: (path: string) => Promise<boolean>;

  // File dialog
  showOpenFileDialog: (options?: { title?: string; filters?: { name: string; extensions: string[] }[]; defaultPath?: string }) => Promise<string | null>;

  // Project operations
  saveProject: (projectData: string, projectPath?: string) => Promise<string | null>;
  loadProject: () => Promise<{ data: unknown; path: string } | null>;
  loadProjectFromPath: (projectPath: string) => Promise<{ data: unknown; path: string } | null>;

  // Recent projects
  getRecentProjects: () => Promise<RecentProject[]>;
  saveRecentProjects: (projects: RecentProject[]) => Promise<boolean>;

  // Scene notes
  saveSceneNotes: (scenePath: string, notes: string) => Promise<boolean>;
  loadSceneNotes: (scenePath: string) => Promise<unknown[]>;

  // Vault asset sync operations
  calculateFileHash: (filePath: string) => Promise<string | null>;
  ensureAssetsFolder: (vaultPath: string) => Promise<string | null>;
  loadAssetIndex: (vaultPath: string) => Promise<AssetIndex>;
  saveAssetIndex: (vaultPath: string, index: AssetIndex) => Promise<boolean>;
  importAssetToVault: (sourcePath: string, vaultPath: string, assetId: string) => Promise<VaultImportResult>;
  verifyVaultAssets: (vaultPath: string) => Promise<VaultVerifyResult>;
  resolveVaultPath: (vaultPath: string, relativePath: string) => Promise<PathResolveResult>;
  getRelativePath: (vaultPath: string, absolutePath: string) => Promise<string | null>;
  isPathInVault: (vaultPath: string, checkPath: string) => Promise<boolean>;

  // Video clip finalization
  showSaveClipDialog: (defaultName: string) => Promise<string | null>;
  finalizeClip: (options: FinalizeClipOptions) => Promise<FinalizeClipResult>;

  // Video frame extraction
  extractVideoFrame: (options: ExtractFrameOptions) => Promise<ExtractFrameResult>;

  // Sequence export
  showSaveSequenceDialog: (defaultName: string) => Promise<string | null>;
  exportSequence: (options: ExportSequenceOptions) => Promise<ExportSequenceResult>;
}

declare global {
  interface Window {
    electronAPI?: ElectronAPI;
  }
}
